<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>سیستم جامع تحلیل بازار طلا با الگوریتم ایچیموکو</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css">
    <style>
        :root {
            /* رنگ‌های اصلی */
            --color-gold-primary: #d4af37;
            --color-gold-secondary: #c09525;
            --color-gold-light: #f5e7bc;
            --color-orange-primary: #ff8f3e;
            --color-orange-secondary: #ff6b1a;
            --color-orange-light: #ffcca8;
            --color-orange-dark: #e25a00;
            --color-green: #16c784;
            --color-red: #ea3943;
            --color-white: #ffffff;
            
            /* انیمیشن‌ها */
            --transition-fast: 0.2s;
            --transition-normal: 0.3s;
            --transition-slow: 0.5s;
            
            /* سایز‌ها */
            --border-radius-sm: 6px;
            --border-radius-md: 10px;
            --border-radius-lg: 16px;
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 12px;
            --spacing-base: 16px;
            --spacing-lg: 24px;
            --spacing-xl: 32px;
            --spacing-xxl: 48px;
            --font-size-xs: 12px;
            --font-size-sm: 14px;
            --font-size-base: 16px;
            --font-size-md: 18px;
            --font-size-lg: 20px;
            --font-size-xl: 24px;
            --font-size-xxl: 28px;
            --font-size-title: 32px;
        }

        /* تم تاریک به عنوان حالت پیش‌فرض */
        body {
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --bg-tertiary: #252525;
            --bg-card: #2d2d2d;
            --text-primary: #f0f0f0;
            --text-secondary: #b8b8b8;
            --text-tertiary: #888888;
            --border-color: #333333;
            --hover-bg: #3a3a3a;
            --chart-bg: #1e222d;
            --chart-grid: #2a2e39;
            --shadow-color: rgba(0,0,0,0.5);
            --card-hover-transform: translateY(-5px);

            background-color: var(--bg-primary);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            font-family: 'Vazirmatn', Tahoma, Arial, sans-serif;
            line-height: 1.6;
            transition: background-color var(--transition-normal), color var(--transition-normal);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* تم روشن */
        body.light-mode {
            --bg-primary: #f7f7f7;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f2f2f2;
            --bg-card: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-tertiary: #999999;
            --border-color: #e0e0e0;
            --hover-bg: #f1f1f1;
            --chart-bg: #ffffff;
            --chart-grid: #f1f1f1;
            --shadow-color: rgba(0,0,0,0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* اسکرول‌بار سفارشی */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--color-orange-primary);
            border-radius: 10px;
            transition: background var(--transition-normal);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--color-orange-secondary);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 var(--spacing-base);
        }

        header {
            background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 50%, var(--color-orange-dark) 100%);
            padding: var(--spacing-lg) 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 20px var(--shadow-color);
            transition: all var(--transition-normal);
        }

        body.light-mode header {
            background: linear-gradient(135deg, var(--color-gold-secondary) 0%, var(--color-orange-primary) 50%, var(--color-orange-secondary) 100%);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--spacing-base);
        }

        .logo-area {
            display: flex;
            flex-direction: column;
        }

        .app-title {
            font-size: var(--font-size-xl);
            font-weight: 800;
            color: #ffffff;
            margin-bottom: var(--spacing-xs);
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .app-subtitle {
            font-size: var(--font-size-sm);
            font-weight: 400;
            color: rgba(255, 255, 255, 0.8);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-md);
            border: none;
            cursor: pointer;
            font-family: 'Vazirmatn', Tahoma, Arial, sans-serif;
            font-size: var(--font-size-sm);
            font-weight: 500;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            background-color: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn:hover {
            background-color: var(--hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        .btn-primary {
            background-color: var(--color-orange-primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--color-orange-secondary);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .btn-outline:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .btn-sm {
            padding: var(--spacing-xs) var(--spacing-sm);
            font-size: var(--font-size-xs);
        }

        .btn-lg {
            padding: var(--spacing-md) var(--spacing-lg);
            font-size: var(--font-size-md);
            font-weight: 600;
        }

        .btn-simulator {
            background: linear-gradient(to right, var(--color-orange-primary), var(--color-orange-secondary));
            color: white;
            padding: var(--spacing-sm) var(--spacing-lg);
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(255, 143, 62, 0.3);
            border-radius: var(--border-radius-md);
        }

        .btn-simulator:hover {
            background: linear-gradient(to right, var(--color-orange-secondary), var(--color-orange-dark));
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(255, 143, 62, 0.4);
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-size: var(--font-size-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            transition: all var(--transition-fast);
            backdrop-filter: blur(5px);
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .price-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-xl) 0;
        }

        .price-card {
            background-color: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            box-shadow: 0 8px 20px var(--shadow-color);
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 143, 62, 0.1);
        }

        .price-card:hover {
            transform: var(--card-hover-transform);
            box-shadow: 0 15px 30px var(--shadow-color);
            border-color: rgba(255, 143, 62, 0.3);
        }

        .price-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, var(--color-gold-primary), var(--color-orange-primary));
        }

        .price-title {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .price-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(255, 143, 62, 0.2));
            color: var(--color-orange-primary);
            font-size: 16px;
            font-weight: bold;
        }

        .price-value {
            font-size: var(--font-size-xl);
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
        }

        .price-change {
            font-size: var(--font-size-sm);
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .price-up {
            color: var(--color-green);
            display: flex;
            align-items: center;
        }

        .price-down {
            color: var(--color-red);
            display: flex;
            align-items: center;
        }

        .price-up::before,
        .price-down::before {
            content: '';
            display: inline-block;
            width: 0;
            height: 0;
            margin-right: 4px;
        }

        .price-up::before {
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 8px solid var(--color-green);
        }

        .price-down::before {
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 8px solid var(--color-red);
        }

        .price-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: var(--font-size-xs);
            color: var(--text-tertiary);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border-color);
        }

        .price-meta-item span:first-child {
            color: var(--text-secondary);
            margin-left: var(--spacing-xs);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--spacing-xl);
            margin: var(--spacing-xl) 0;
        }

        @media (min-width: 992px) {
            .main-content {
                grid-template-columns: 3fr 1fr;
            }
        }

        .card {
            background-color: var(--bg-card);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            box-shadow: 0 8px 20px var(--shadow-color);
            transition: all var(--transition-normal);
            border: 1px solid var(--border-color);
        }

        .card:hover {
            box-shadow: 0 12px 25px var(--shadow-color);
        }

        .card-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            background: linear-gradient(to right, var(--bg-card), var(--bg-tertiary));
        }

        .card-body {
            padding: var(--spacing-lg);
        }

        .chart-container {
            height: 500px;
            background-color: var(--chart-bg);
            border-radius: var(--border-radius-md);
            overflow: hidden;
            box-shadow: inset 0 0 10px var(--shadow-color);
            transition: height var(--transition-normal);
        }

        @media (max-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        .chart-toolbar {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
            gap: var(--spacing-md);
            padding: var(--spacing-md);
            background-color: var(--bg-tertiary);
            border-radius: var(--border-radius-md);
        }

        .timeframe-btns {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
        }

        .timeframe-btn {
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--border-radius-sm);
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            cursor: pointer;
            font-size: var(--font-size-xs);
            transition: all var(--transition-fast);
        }

        .timeframe-btn:hover {
            background-color: var(--hover-bg);
            transform: translateY(-2px);
        }

        .timeframe-btn.active {
            background: linear-gradient(to right, var(--color-gold-primary), var(--color-orange-primary));
            color: white;
            border-color: transparent;
            box-shadow: 0 2px 5px rgba(255, 143, 62, 0.3);
        }

        .chart-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        .ichimoku-settings {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--spacing-lg);
            margin-top: var(--spacing-lg);
            padding: var(--spacing-lg);
            background-color: var(--bg-tertiary);
            border-radius: var(--border-radius-md);
        }

        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--spacing-xs);
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: var(--spacing-md);
            border-radius: var(--border-radius-md);
            border: 1px solid var(--border-color);
            background-color: var(--bg-card);
            color: var(--text-primary);
            font-size: var(--font-size-base);
            font-family: 'Vazirmatn', Tahoma, Arial, sans-serif;
            transition: all var(--transition-fast);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-orange-primary);
            box-shadow: 0 0 0 3px rgba(255, 143, 62, 0.2);
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: var(--spacing-lg);
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--color-orange-primary) var(--bg-tertiary);
        }

        .tab {
            padding: var(--spacing-md) var(--spacing-lg);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
            transition: all var(--transition-fast);
            font-weight: 500;
        }

        .tab:hover {
            color: var(--color-orange-primary);
            background-color: var(--bg-tertiary);
        }

        .tab.active {
            border-bottom-color: var(--color-orange-primary);
            color: var(--color-orange-primary);
            font-weight: 600;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .signals-list, .news-list {
            list-style: none;
        }

        .signal-item, .news-item {
            padding: var(--spacing-lg) 0;
            border-bottom: 1px solid var(--border-color);
            transition: all var(--transition-fast);
        }

        .signal-item:hover, .news-item:hover {
            background-color: var(--bg-tertiary);
            transform: translateX(-5px);
            padding-left: var(--spacing-md);
            border-left: 3px solid var(--color-orange-primary);
        }

        .signal-item:last-child, .news-item:last-child {
            border-bottom: none;
        }

        .signal-time, .news-time {
            font-size: var(--font-size-xs);
            color: var(--text-tertiary);
            margin-bottom: var(--spacing-xs);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .signal-time::before {
            content: '⏱️';
            font-size: 12px;
        }

        .signal-type {
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-md);
        }

        .signal-buy {
            color: var(--color-green);
        }

        .signal-sell {
            color: var(--color-red);
        }

        .signal-desc {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .news-title {
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-base);
        }

        .news-impact {
            display: inline-block;
            padding: 2px var(--spacing-md);
            border-radius: 50px;
            font-size: var(--font-size-xs);
            margin-left: var(--spacing-sm);
            font-weight: 500;
        }

        .impact-high {
            background-color: rgba(234, 57, 67, 0.15);
            color: var(--color-red);
        }

        .impact-medium {
            background-color: rgba(255, 143, 62, 0.15);
            color: var(--color-orange-primary);
        }

        .impact-low {
            background-color: rgba(22, 199, 132, 0.15);
            color: var(--color-green);
        }

        .price-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--spacing-md);
            border-radius: var(--border-radius-md);
            overflow: hidden;
        }

        .price-table th, .price-table td {
            padding: var(--spacing-md) var(--spacing-md);
            text-align: right;
            border-bottom: 1px solid var(--border-color);
            transition: all var(--transition-fast);
        }

        .price-table th {
            background-color: var(--bg-tertiary);
            color: var(--text-secondary);
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .price-table tr:hover td {
            background-color: var(--bg-tertiary);
        }

        .price-table tr:last-child td {
            border-bottom: none;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-xl);
            text-align: center;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 143, 62, 0.1);
            border-radius: 50%;
            border-top-color: var(--color-orange-primary);
            animation: spin 1s linear infinite;
            margin-bottom: var(--spacing-lg);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            animation: modalFadeIn 0.3s ease;
        }

        .modal-content {
            background-color: var(--bg-card);
            margin: 5% auto;
            border-radius: var(--border-radius-lg);
            max-width: 800px;
            width: 90%;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .modal-header {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to right, var(--bg-card), var(--bg-tertiary));
        }

        .modal-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
        }

        .modal-body {
            padding: var(--spacing-lg);
            max-height: 70vh;
            overflow-y: auto;
        }

        .close-btn {
            color: var(--text-tertiary);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all var(--transition-fast);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-btn:hover {
            color: var(--color-orange-primary);
            background-color: var(--bg-tertiary);
            transform: rotate(90deg);
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes modalSlideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .bubble-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 5px;
        }

        .bubble-high {
            background-color: var(--color-red);
            box-shadow: 0 0 5px var(--color-red);
        }

        .bubble-medium {
            background-color: var(--color-orange-primary);
            box-shadow: 0 0 5px var(--color-orange-primary);
        }

        .bubble-low {
            background-color: var(--color-green);
            box-shadow: 0 0 5px var(--color-green);
        }

        .tutorial-section {
            margin-bottom: var(--spacing-xxl);
        }

        .tutorial-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            margin-bottom: var(--spacing-lg);
            color: var(--color-orange-primary);
            padding-bottom: var(--spacing-sm);
            border-bottom: 2px solid var(--color-orange-light);
            display: inline-block;
        }

        .tutorial-content {
            line-height: 1.8;
        }

        .tutorial-content p, .tutorial-content ul {
            margin-bottom: var(--spacing-md);
        }

        .tutorial-content ul {
            padding-right: var(--spacing-lg);
        }

        .tutorial-content li {
            margin-bottom: var(--spacing-sm);
        }

        .tutorial-image {
            max-width: 100%;
            border-radius: var(--border-radius-md);
            margin: var(--spacing-lg) 0;
            border: 1px solid var(--border-color);
            box-shadow: 0 5px 15px var(--shadow-color);
            transition: all var(--transition-normal);
        }

        .tutorial-image:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px var(--shadow-color);
        }

        .strategy-item {
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-xl);
            border-bottom: 1px solid var(--border-color);
        }

        .strategy-item:last-child {
            border-bottom: none;
        }

        .strategy-title {
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            font-size: var(--font-size-md);
            color: var(--color-orange-primary);
        }

        .strategy-desc {
            margin-bottom: var(--spacing-md);
            color: var(--text-secondary);
            font-size: var(--font-size-base);
        }

        .strategy-example {
            background-color: var(--bg-tertiary);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-md);
            font-size: var(--font-size-sm);
            border-right: 3px solid var(--color-orange-primary);
            line-height: 1.8;
        }

        .simulator-banner {
            background: linear-gradient(135deg, var(--color-gold-secondary) 0%, var(--color-orange-primary) 100%);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            margin: var(--spacing-xl) 0;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 10px 30px rgba(255, 143, 62, 0.3);
            position: relative;
            overflow: hidden;
        }

        .simulator-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://i.imgur.com/JkJQoXD.png');
            background-size: cover;
            background-position: center;
            opacity: 0.1;
            z-index: 0;
        }

        .simulator-banner-content {
            position: relative;
            z-index: 1;
        }

        .simulator-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            margin-bottom: var(--spacing-md);
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .simulator-desc {
            font-size: var(--font-size-base);
            margin-bottom: var(--spacing-lg);
            max-width: 600px;
            line-height: 1.6;
        }

        .pulse-animation {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .footer {
            background-color: var(--bg-secondary);
            padding: var(--spacing-xl) 0;
            margin-top: var(--spacing-xxl);
            border-top: 1px solid var(--border-color);
        }

        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: var(--spacing-xl);
        }

        .footer-section {
            flex: 1;
            min-width: 250px;
        }

        .footer-title {
            font-size: var(--font-size-md);
            font-weight: 600;
            margin-bottom: var(--spacing-md);
            color: var(--color-orange-primary);
        }

        .footer-links {
            list-style: none;
        }

        .footer-link {
            margin-bottom: var(--spacing-sm);
        }

        .footer-link a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: all var(--transition-fast);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .footer-link a:hover {
            color: var(--color-orange-primary);
            transform: translateX(-5px);
        }

        .footer-link a::before {
            content: '▸';
            color: var(--color-orange-primary);
        }

        .footer-bottom {
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-tertiary);
            font-size: var(--font-size-sm);
        }

        @media (max-width: 768px) {
            .price-cards {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
            
            .ichimoku-settings {
                grid-template-columns: 1fr;
            }
            
            .chart-toolbar {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .header-actions {
                margin-top: var(--spacing-sm);
                width: 100%;
                justify-content: center;
            }

            .app-title {
                text-align: center;
                margin-bottom: var(--spacing-sm);
            }

            .app-subtitle {
                text-align: center;
            }

            .logo-area {
                width: 100%;
                align-items: center;
            }
        }

        /* انیمیشن‌های اضافی */
        .hover-lift {
            transition: transform var(--transition-fast);
        }

        .hover-lift:hover {
            transform: translateY(-3px);
        }

        .hover-scale {
            transition: transform var(--transition-fast);
        }

        .hover-scale:hover {
            transform: scale(1.05);
        }

        .highlight-text {
            color: var(--color-orange-primary);
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo-area">
                    <div class="app-title">سیستم تحلیل بازار طلا با ایچیموکو</div>
                    <div class="app-subtitle">نسخه حرفه‌ای با تحلیل و شبیه‌سازی هوشمند</div>
                </div>
                <div class="header-actions">
                    <a href="#simulator" class="btn-simulator pulse-animation">
                        <span>ورود به شبیه‌ساز</span>
                        <span>🚀</span>
                    </a>
                    <button class="theme-toggle" id="themeToggle">
                        <span id="themeIcon">☀️</span>
                        <span id="themeText">حالت روشن</span>
                    </button>
                </div>
            </div>
        </header>

        

        <div class="main-content">
            <div class="main-panel">
                <div class="card">
                    <div class="card-header">
                        <span>نمودار قیمت طلا با ایچیموکو</span>
                        <button class="btn btn-primary btn-sm" onclick="refreshChart()">
                            <span>🔄</span>
                            <span>بروزرسانی نمودار</span>
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="chart-toolbar">
                            <div class="timeframe-btns">
                                <button class="timeframe-btn active" data-timeframe="M5">۵ دقیقه</button>
                                <button class="timeframe-btn" data-timeframe="M15">۱۵ دقیقه</button>
                                <button class="timeframe-btn" data-timeframe="M30">۳۰ دقیقه</button>
                                <button class="timeframe-btn" data-timeframe="H1">۱ ساعت</button>
                                <button class="timeframe-btn" data-timeframe="H4">۴ ساعت</button>
                                <button class="timeframe-btn" data-timeframe="D1">روزانه</button>
                            </div>
                            <div class="chart-actions">
                                <button class="btn btn-sm" onclick="addTrendLine()">
                                    <span>📈</span>
                                    <span>خط روند</span>
                                </button>
                                <button class="btn btn-sm" onclick="addFibonacci()">
                                    <span>🔄</span>
                                    <span>فیبوناچی</span>
                                </button>
                                <button class="btn btn-sm btn-primary" onclick="saveAnalysis()">
                                    <span>💾</span>
                                    <span>ذخیره تحلیل</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="chart-container" id="chartContainer">
                            <!-- نمودار TradingView اینجا بارگذاری می‌شود -->
                        </div>

                        <div class="ichimoku-settings">
                            <div class="form-group">
                                <label>تنکان-سن (Tenkan-sen)</label>
                                <input type="number" id="tenkanSen" class="form-control" value="9" min="1">
                            </div>
                            <div class="form-group">
                                <label>کیجون-سن (Kijun-sen)</label>
                                <input type="number" id="kijunSen" class="form-control" value="26" min="1">
                            </div>
                            <div class="form-group">
                                <label>سنکو اسپن B (Senkou Span B)</label>
                                <input type="number" id="senkouSpanB" class="form-control" value="52" min="1">
                            </div>
                            <div class="form-group">
                                <label>چیکو اسپن (Chikou Span)</label>
                                <input type="number" id="chikouSpan" class="form-control" value="26" min="1">
                            </div>
                            <button class="btn btn-primary" onclick="applyIchimokuSettings()">
                                <span>✅</span>
                                <span>اعمال تنظیمات</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: var(--spacing-xl);">
                    <div class="card-header">
                        <span>قیمت‌های لحظه‌ای بازار طلا و سکه</span>
                        <button class="btn btn-primary btn-sm" onclick="fetchGoldPrices()">
                            <span>🔄</span>
                            <span>بروزرسانی</span>
                        </button>
                    </div>
                    <div class="card-body" id="goldPricesContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>در حال دریافت قیمت‌ها...</p>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: var(--spacing-xl);">
                    <div class="card-header">تحلیل هوشمند ایچیموکو</div>
                    <div class="card-body">
                        <div class="tabs">
                            <div class="tab active" data-tab="signals">سیگنال‌های معاملاتی</div>
                            <div class="tab" data-tab="analysis">تحلیل تکنیکال</div>
                            <div class="tab" data-tab="prediction">پیش‌بینی قیمت</div>
                        </div>
                        
                        <div class="tab-content active" id="signals">
                            <ul class="signals-list" id="signalsList">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    <p>در حال تحلیل سیگنال‌ها...</p>
                                </div>
                            </ul>
                        </div>
                        
                        <div class="tab-content" id="analysis">
                            <div id="technicalAnalysisContainer">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    <p>در حال تحلیل تکنیکال...</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-content" id="prediction">
                            <div id="pricePredictionContainer">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    <p>در حال محاسبه پیش‌بینی‌ها...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- بنر شبیه‌ساز -->
                <div id="simulator" class="simulator-banner">
                    <div class="simulator-banner-content">
                        <h2 class="simulator-title">شبیه‌ساز معاملات طلا</h2>
                        <p class="simulator-desc">با استفاده از شبیه‌ساز پیشرفته ما، بدون ریسک مالی استراتژی‌های معاملاتی خود را آزمایش کنید و مهارت‌های خود را در بازار طلا بهبود بخشید.</p>
                        <a href="https://gold-simulator.example.com" target="_blank" class="btn-lg btn-simulator hover-scale">
                            <span>ورود به شبیه‌ساز</span>
                            <span>🚀</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="sidebar">
                <div class="card">
                    <div class="card-header">
                        <span>قیمت‌های ارز</span>
                        <button class="btn btn-primary btn-sm" onclick="fetchCurrencyPrices()">
                            <span>🔄</span>
                            <span>بروزرسانی</span>
                        </button>
                    </div>
                    <div class="card-body" id="currencyPricesContainer">
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <p>در حال دریافت قیمت‌ها...</p>
                        </div>
                    </div>
                </div>
                
                <div class="card" style="margin-top: var(--spacing-xl);">
                    <div class="card-header">اخبار مهم تأثیرگذار بر بازار طلا</div>
                    <div class="card-body">
                        <ul class="news-list">
                            <li class="news-item hover-lift" onclick="openNewsModal('جلسه فدرال رزرو: نرخ بهره بدون تغییر ماند', 'فدرال رزرو در آخرین نشست خود تصمیم گرفت نرخ بهره را بدون تغییر نگه دارد، اما اشاره کرد که ممکن است در آینده نزدیک کاهش نرخ بهره را در نظر بگیرد. این خبر می‌تواند تأثیر مثبتی بر قیمت طلا داشته باشد.', 'بالا')">
                                <div class="news-time">2 ساعت پیش</div>
                                <div class="news-title">
                                    <span class="news-impact impact-high">تأثیر بالا</span>
                                    جلسه فدرال رزرو: نرخ بهره بدون تغییر ماند
                                </div>
                            </li>
                            <li class="news-item hover-lift" onclick="openNewsModal('افزایش تنش‌های ژئوپلیتیکی در خاورمیانه', 'تنش‌های ژئوپلیتیکی در خاورمیانه افزایش یافته و این موضوع می‌تواند باعث افزایش تقاضا برای طلا به عنوان دارایی امن شود.', 'متوسط')">
                                <div class="news-time">5 ساعت پیش</div>
                                <div class="news-title">
                                    <span class="news-impact impact-medium">تأثیر متوسط</span>
                                    افزایش تنش‌های ژئوپلیتیکی در خاورمیانه
                                </div>
                            </li>
                            <li class="news-item hover-lift" onclick="openNewsModal('انتشار داده‌های اشتغال آمریکا', 'داده‌های اشتغال آمریکا ضعیف‌تر از انتظار بود که می‌تواند باعث تضعیف دلار و تقویت قیمت طلا شود.', 'بالا')">
                                <div class="news-time">دیروز</div>
                                <div class="news-title">
                                    <span class="news-impact impact-high">تأثیر بالا</span>
                                    انتشار داده‌های اشتغال آمریکا
                                </div>
                            </li>
                        </ul>
                        <button class="btn btn-primary" style="width: 100%; margin-top: var(--spacing-lg);" onclick="openAllNewsModal()">
                            <span>📰</span>
                            <span>مشاهده همه اخبار</span>
                        </button>
                    </div>
                </div>
                
                <div class="card" style="margin-top: var(--spacing-xl);">
                    <div class="card-header">آموزش استراتژی‌های ایچیموکو</div>
                    <div class="card-body">
                        <div class="strategy-item">
                            <div class="strategy-title">استراتژی تقاطع تنکان-سن و کیجون-سن</div>
                            <div class="strategy-desc">این استراتژی بر اساس تقاطع خطوط تنکان-سن و کیجون-سن عمل می‌کند.</div>
                            <div class="strategy-example">
                                <strong class="highlight-text">خرید:</strong> تنکان-سن از پایین کیجون-سن را قطع کند.<br>
                                <strong class="highlight-text">فروش:</strong> تنکان-سن از بالا کیجون-سن را قطع کند.
                            </div>
                        </div>
                        
                        <div class="strategy-item">
                            <div class="strategy-title">استراتژی ابر کومو</div>
                            <div class="strategy-desc">در این استراتژی، موقعیت قیمت نسبت به ابر کومو تعیین‌کننده است.</div>
                            <div class="strategy-example">
                                <strong class="highlight-text">خرید:</strong> قیمت بالای ابر کومو باشد و ابر سبز باشد.<br>
                                <strong class="highlight-text">فروش:</strong> قیمت زیر ابر کومو باشد و ابر قرمز باشد.
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" style="width: 100%; margin-top: var(--spacing-md);" onclick="openTutorialModal()">
                            <span>📚</span>
                            <span>مشاهده آموزش کامل</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

    
    <!-- مودال همه اخبار -->
    <div id="allNewsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">آخرین اخبار تأثیرگذار بر بازار طلا</h3>
                <span class="close-btn" onclick="closeModal('allNewsModal')">&times;</span>
            </div>
            <div class="modal-body">
                <ul class="news-list">
                    <li class="news-item">
                        <div class="news-time">2 ساعت پیش</div>
                        <div class="news-title">
                            <span class="news-impact impact-high">تأثیر بالا</span>
                            جلسه فدرال رزرو: نرخ بهره بدون تغییر ماند
                        </div>
                        <p style="margin-top: var(--spacing-sm); color: var(--text-secondary);">فدرال رزرو در آخرین نشست خود تصمیم گرفت نرخ بهره را بدون تغییر نگه دارد، اما اشاره کرد که ممکن است در آینده نزدیک کاهش نرخ بهره را در نظر بگیرد. این خبر می‌تواند تأثیر مثبتی بر قیمت طلا داشته باشد.</p>
                    </li>
                    <li class="news-item">
                        <div class="news-time">5 ساعت پیش</div>
                        <div class="news-title">
                            <span class="news-impact impact-medium">تأثیر متوسط</span>
                            افزایش تنش‌های ژئوپلیتیکی در خاورمیانه
                        </div>
                        <p style="margin-top: var(--spacing-sm); color: var(--text-secondary);">تنش‌های ژئوپلیتیکی در خاورمیانه افزایش یافته و این موضوع می‌تواند باعث افزایش تقاضا برای طلا به عنوان دارایی امن شود.</p>
                    </li>
                    <li class="news-item">
                        <div class="news-time">دیروز</div>
                        <div class="news-title">
                            <span class="news-impact impact-high">تأثیر بالا</span>
                            انتشار داده‌های اشتغال آمریکا
                        </div>
                        <p style="margin-top: var(--spacing-sm); color: var(--text-secondary);">داده‌های اشتغال آمریکا ضعیف‌تر از انتظار بود که می‌تواند باعث تضعیف دلار و تقویت قیمت طلا شود.</p>
                    </li>
                    <li class="news-item">
                        <div class="news-time">2 روز پیش</div>
                        <div class="news-title">
                            <span class="news-impact impact-low">تأثیر پایین</span>
                            افزایش تقاضای فیزیکی طلا در چین
                        </div>
                        <p style="margin-top: var(--spacing-sm); color: var(--text-secondary);">گزارش‌ها حاکی از افزایش تقاضای فیزیکی طلا در چین است که می‌تواند به تقویت قیمت طلا در بازارهای جهانی کمک کند.</p>
                    </li>
                    <li class="news-item">
                        <div class="news-time">3 روز پیش</div>
                        <div class="news-title">
                            <span class="news-impact impact-medium">تأثیر متوسط</span>
                            تغییر در سیاست‌های پولی بانک مرکزی اروپا
                        </div>
                        <p style="margin-top: var(--spacing-sm); color: var(--text-secondary);">بانک مرکزی اروپا اعلام کرده که ممکن است سیاست‌های پولی خود را در ماه‌های آینده تغییر دهد. این موضوع می‌تواند بر نرخ یورو و به تبع آن بر قیمت طلا تأثیرگذار باشد.</p>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- مودال آموزش -->
    <div id="tutorialModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">آموزش جامع استراتژی‌های معاملاتی ایچیموکو در بازار طلا</h3>
                <span class="close-btn" onclick="closeModal('tutorialModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="tutorial-section">
                    <div class="tutorial-title">مقدمه‌ای بر ایچیموکو</div>
                    <div class="tutorial-content">
                        <p>ایچیموکو کینکو هیو (Ichimoku Kinko Hyo) یک سیستم تحلیل تکنیکال است که توسط گویچی هوسودا، روزنامه‌نگار ژاپنی در دهه 1930 توسعه داده شد. نام آن به معنای "نمودار تعادل در یک نگاه" است و هدف آن ارائه تصویری جامع از وضعیت بازار است.</p>
                        <p>اجزای اصلی ایچیموکو عبارتند از:</p>
                        <ul>
                            <li><strong class="highlight-text">تنکان-سن (Tenkan-sen):</strong> خط تبدیل، میانگین قیمت‌های بالا و پایین در 9 دوره اخیر</li>
                            <li><strong class="highlight-text">کیجون-سن (Kijun-sen):</strong> خط پایه، میانگین قیمت‌های بالا و پایین در 26 دوره اخیر</li>
                            <li><strong class="highlight-text">سنکو اسپن A (Senkou Span A):</strong> خط اول ابر، میانگین تنکان-سن و کیجون-سن که 26 دوره به جلو منتقل می‌شود</li>
                            <li><strong class="highlight-text">سنکو اسپن B (Senkou Span B):</strong> خط دوم ابر، میانگین قیمت‌های بالا و پایین در 52 دوره اخیر که 26 دوره به جلو منتقل می‌شود</li>
                            <li><strong class="highlight-text">چیکو اسپن (Chikou Span):</strong> خط تأخیری، قیمت فعلی که 26 دوره به عقب منتقل می‌شود</li>
                        </ul>
                        <img src="https://i.imgur.com/JkJQoXD.png" alt="اجزای ایچیموکو" class="tutorial-image">
                    </div>
                </div>
                
                <div class="tutorial-section">
                    <div class="tutorial-title">استراتژی‌های معاملاتی ایچیموکو</div>
                    <div class="tutorial-content">
                        <h4>1. استراتژی تقاطع تنکان-سن و کیجون-سن</h4>
                        <p>این استراتژی یکی از ساده‌ترین استراتژی‌های ایچیموکو است:</p>
                        <ul>
                            <li><strong class="highlight-text">سیگنال خرید:</strong> زمانی که تنکان-سن از پایین کیجون-سن را قطع می‌کند</li>
                            <li><strong class="highlight-text">سیگنال فروش:</strong> زمانی که تنکان-سن از بالا کیجون-سن را قطع می‌کند</li>
                        </ul>
                        <p>برای افزایش دقت این استراتژی، می‌توان آن را با موقعیت قیمت نسبت به ابر کومو ترکیب کرد.</p>
                        <img src="https://i.imgur.com/nV8Y0aO.png" alt="استراتژی تقاطع" class="tutorial-image">
                        
                        <h4>2. استراتژی ابر کومو</h4>
                        <p>در این استراتژی، موقعیت قیمت نسبت به ابر کومو تعیین‌کننده است:</p>
                        <ul>
                            <li><strong class="highlight-text">روند صعودی:</strong> قیمت بالای ابر کومو، ابر سبز (سنکو اسپن A بالای سنکو اسپن B)</li>
                            <li><strong class="highlight-text">روند نزولی:</strong> قیمت زیر ابر کومو، ابر قرمز (سنکو اسپن A زیر سنکو اسپن B)</li>
                            <li><strong class="highlight-text">بدون روند مشخص:</strong> قیمت داخل ابر کومو</li>
                        </ul>
                        <img src="https://i.imgur.com/QwJYL1P.png" alt="استراتژی ابر کومو" class="tutorial-image">
                        
                        <h4>3. استراتژی چیکو اسپن</h4>
                        <p>این استراتژی بر اساس موقعیت چیکو اسپن نسبت به قیمت عمل می‌کند:</p>
                        <ul>
                            <li><strong class="highlight-text">سیگنال خرید:</strong> چیکو اسپن بالای قیمت 26 دوره قبل و بدون برخورد با کندل‌های قیمت</li>
                            <li><strong class="highlight-text">سیگنال فروش:</strong> چیکو اسپن زیر قیمت 26 دوره قبل و بدون برخورد با کندل‌های قیمت</li>
                        </ul>
                    </div>
                </div>
                
                <div class="tutorial-section">
                    <div class="tutorial-title">نکات ویژه برای معامله طلا با ایچیموکو</div>
                    <div class="tutorial-content">
                        <p>طلا دارای ویژگی‌های خاصی است که باید در هنگام استفاده از ایچیموکو به آن‌ها توجه کرد:</p>
                        <ul>
                            <li><strong class="highlight-text">نوسانات شدید:</strong> طلا گاهی دارای نوسانات شدید است، بنابراین استفاده از تایم‌فریم‌های بالاتر (H4 یا D1) برای سیگنال‌های قوی‌تر توصیه می‌شود.</li>
                            <li><strong class="highlight-text">تأثیر اخبار:</strong> قیمت طلا به شدت تحت تأثیر اخبار اقتصادی و ژئوپلیتیکی است، بنابراین همیشه تقویم اقتصادی را بررسی کنید.</li>
                            <li><strong class="highlight-text">همبستگی با دلار:</strong> معمولاً طلا با دلار آمریکا همبستگی معکوس دارد. تقویت دلار معمولاً باعث کاهش قیمت طلا می‌شود و برعکس.</li>
                            <li><strong class="highlight-text">تنظیمات ایچیموکو:</strong> برخی معامله‌گران برای طلا از تنظیمات سفارشی ایچیموکو استفاده می‌کنند، مانند (7, 22, 44) به جای تنظیمات استاندارد (9, 26, 52).</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- لود کردن TradingView Widget -->
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    
    <script>
        // متغیرهای جهانی
        let goldData = null;
        let currencyData = null;
        let tvWidget = null;
        let currentTimeframe = "M5";
        let ichimokuSettings = {
            tenkanSen: 9,
            kijunSen: 26,
            senkouSpanB: 52,
            chikouSpan: 26
        };

        // تابع اجرای اولیه صفحه
        document.addEventListener('DOMContentLoaded', function() {
            // راه‌اندازی تم دارک به عنوان پیش‌فرض
            setupThemeToggle();
            
            // دریافت قیمت‌های طلا و ارز
            fetchGoldPrices();
            fetchCurrencyPrices();
            
            // راه‌اندازی نمودار TradingView
            initTradingViewChart();
            
            // راه‌اندازی تب‌ها
            setupTabs();
            
            // راه‌اندازی دکمه‌های تایم‌فریم
            setupTimeframeButtons();
            
            // تحلیل تکنیکال و پیش‌بینی قیمت
            generateTechnicalAnalysis();
            generatePricePrediction();
            
            // تولید سیگنال‌های معاملاتی
            generateTradingSignals();
            
            // اضافه کردن افکت اسکرول نرم برای لینک‌های داخلی
            setupSmoothScroll();
        });

        // تابع راه‌اندازی اسکرول نرم
        function setupSmoothScroll() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    
                    const targetId = this.getAttribute('href');
                    if (targetId === '#') return;
                    
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        }

        // تابع راه‌اندازی تغییر تم
        function setupThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            themeToggle.addEventListener('click', function() {
                if (document.body.classList.contains('light-mode')) {
                    // تغییر به حالت تاریک
                    document.body.classList.remove('light-mode');
                    themeIcon.textContent = '☀️';
                    themeText.textContent = 'حالت روشن';
                    
                    // تغییر تم نمودار اگر نمودار راه‌اندازی شده باشد
                    if (tvWidget) {
                        tvWidget.changeTheme('dark');
                    }
                } else {
                    // تغییر به حالت روشن
                    document.body.classList.add('light-mode');
                    themeIcon.textContent = '🌙';
                    themeText.textContent = 'حالت تاریک';
                    
                    // تغییر تم نمودار اگر نمودار راه‌اندازی شده باشد
                    if (tvWidget) {
                        tvWidget.changeTheme('light');
                    }
                }
            });
        }
        
        // تابع راه‌اندازی نمودار TradingView
        function initTradingViewChart() {
            tvWidget = new TradingView.widget({
                "autosize": true,
                "symbol": "OANDA:XAUUSD",
                "interval": "5",
                "timezone": "Asia/Tehran",
                "theme": document.body.classList.contains('light-mode') ? "light" : "dark",
                "style": "1",
                "locale": "fa_IR",
                "toolbar_bg": "rgba(0, 0, 0, 0)",
                "hide_top_toolbar": false,
                "hide_side_toolbar": false,
                "hide_legend": false,
                "enable_publishing": false,
                "allow_symbol_change": true,
                "save_image": true,
                "studies": [
                    {
                        "id": "IchimokuCloud@tv-basicstudies",
                        "inputs": {
                            "conversionLine": ichimokuSettings.tenkanSen,
                            "baseLine": ichimokuSettings.kijunSen,
                            "laggingSpan2": ichimokuSettings.senkouSpanB,
                            "displacement": ichimokuSettings.chikouSpan
                        }
                    }
                ],
                "container_id": "chartContainer",
                "overrides": {
                    "mainSeriesProperties.candleStyle.upColor": "#16c784",
                    "mainSeriesProperties.candleStyle.downColor": "#ea3943",
                    "mainSeriesProperties.candleStyle.borderUpColor": "#16c784",
                    "mainSeriesProperties.candleStyle.borderDownColor": "#ea3943",
                    "mainSeriesProperties.candleStyle.wickUpColor": "#16c784",
                    "mainSeriesProperties.candleStyle.wickDownColor": "#ea3943",
                    "paneProperties.background": document.body.classList.contains('light-mode') ? "#ffffff" : "#1e222d",
                    "paneProperties.vertGridProperties.color": document.body.classList.contains('light-mode') ? "#f1f1f1" : "#2a2e39",
                    "paneProperties.horzGridProperties.color": document.body.classList.contains('light-mode') ? "#f1f1f1" : "#2a2e39",
                    "scalesProperties.textColor": document.body.classList.contains('light-mode') ? "#333333" : "#e0e0e0"
                }
            });
        }
        
        // تابع دریافت قیمت‌های طلا و سکه
        async function fetchGoldPrices() {
            try {
                // نمایش لودینگ
                document.getElementById('goldPricesContainer').innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>در حال دریافت قیمت‌ها...</p>
                    </div>
                `;
                
                // دریافت داده‌ها از API
                const response = await fetch('https://brsapi.ir/FreeTsetmcBourseApi/Api_Free_Gold_Currency_v2.json');
                const data = await response.json();
                
                // ذخیره داده‌ها
                goldData = data.gold;
                
                // بروزرسانی هدر
                updateHeaderPrices();
                
                // نمایش جدول قیمت‌ها
                displayGoldPrices();
                
                // نمایش اعلان موفقیت
                showNotification('قیمت‌های طلا با موفقیت بروزرسانی شدند', 'success');
                
            } catch (error) {
                console.error('خطا در دریافت قیمت‌های طلا:', error);
                document.getElementById('goldPricesContainer').innerHTML = `
                    <div style="text-align: center; padding: var(--spacing-xl); color: var(--color-red);">
                        <p>خطا در دریافت قیمت‌ها. لطفاً مجدداً تلاش کنید.</p>
                        <button class="btn btn-primary" style="margin-top: var(--spacing-md);" onclick="fetchGoldPrices()">تلاش مجدد</button>
                    </div>
                `;
                
                // نمایش اعلان خطا
                showNotification('خطا در دریافت قیمت‌های طلا', 'error');
            }
        }
        
        // تابع دریافت قیمت‌های ارز
        async function fetchCurrencyPrices() {
            try {
                // نمایش لودینگ
                document.getElementById('currencyPricesContainer').innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>در حال دریافت قیمت‌ها...</p>
                    </div>
                `;
                
                // دریافت داده‌ها از API
                const response = await fetch('https://brsapi.ir/FreeTsetmcBourseApi/Api_Free_Gold_Currency_v2.json');
                const data = await response.json();
                
                // ذخیره داده‌ها
                currencyData = data.currency;
                
                // نمایش جدول قیمت‌ها
                displayCurrencyPrices();
                
                // نمایش اعلان موفقیت
                showNotification('قیمت‌های ارز با موفقیت بروزرسانی شدند', 'success');
                
            } catch (error) {
                console.error('خطا در دریافت قیمت‌های ارز:', error);
                document.getElementById('currencyPricesContainer').innerHTML = `
                    <div style="text-align: center; padding: var(--spacing-xl); color: var(--color-red);">
                        <p>خطا در دریافت قیمت‌ها. لطفاً مجدداً تلاش کنید.</p>
                        <button class="btn btn-primary" style="margin-top: var(--spacing-md);" onclick="fetchCurrencyPrices()">تلاش مجدد</button>
                    </div>
                `;
                
                // نمایش اعلان خطا
                showNotification('خطا در دریافت قیمت‌های ارز', 'error');
            }
        }
        
        // تابع نمایش اعلان
        function showNotification(message, type = 'info') {
            // ایجاد عنصر اعلان
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            // تنظیم استایل بر اساس نوع اعلان
            let bgColor, textColor, icon;
            
            switch(type) {
                case 'success':
                    bgColor = 'rgba(22, 199, 132, 0.95)';
                    textColor = '#fff';
                    icon = '✅';
                    break;
                case 'error':
                    bgColor = 'rgba(234, 57, 67, 0.95)';
                    textColor = '#fff';
                    icon = '❌';
                    break;
                default:
                    bgColor = 'rgba(255, 143, 62, 0.95)';
                    textColor = '#fff';
                    icon = 'ℹ️';
            }
            
            // تنظیم استایل
            Object.assign(notification.style, {
                position: 'fixed',
                bottom: '20px',
                right: '20px',
                backgroundColor: bgColor,
                color: textColor,
                padding: '12px 20px',
                borderRadius: '8px',
                boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
                zIndex: '9999',
                display: 'flex',
                alignItems: 'center',
                gap: '8px',
                fontFamily: "'Vazirmatn', Tahoma, Arial, sans-serif",
                fontSize: '14px',
                transform: 'translateY(100px)',
                opacity: '0',
                transition: 'transform 0.3s ease, opacity 0.3s ease'
            });
            
            // افزودن محتوا
            notification.innerHTML = `<span style="font-size: 16px;">${icon}</span> ${message}`;
            
            // افزودن به صفحه
            document.body.appendChild(notification);
            
            // نمایش با انیمیشن
            setTimeout(() => {
                notification.style.transform = 'translateY(0)';
                notification.style.opacity = '1';
            }, 10);
            
            // حذف پس از 3 ثانیه
            setTimeout(() => {
                notification.style.transform = 'translateY(100px)';
                notification.style.opacity = '0';
                
                // حذف از DOM پس از اتمام انیمیشن
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // تابع نمایش قیمت‌های طلا در جدول
        function displayGoldPrices() {
            if (!goldData) return;
            
            let html = `
                <h3 style="margin-bottom: var(--spacing-lg); color: var(--color-orange-primary);">قیمت‌های لحظه‌ای طلا و سکه</h3>
                <div style="overflow-x: auto; border-radius: var(--border-radius-md);">
                    <table class="price-table">
                        <thead>
                            <tr>
                                <th>نام</th>
                                <th>قیمت</th>
                                <th>تغییر</th>
                                <th>حباب</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            goldData.forEach(item => {
                // تعیین کلاس برای تغییرات قیمت
                const priceChangeClass = item.price_change > 0 ? 'price-up' : (item.price_change < 0 ? 'price-down' : '');
                
                // تعیین کلاس برای حباب
                let bubbleClass = '';
                let bubbleTitle = '';
                
                if (item.bubble) {
                    if (item.bubble > 10000000) {
                        bubbleClass = 'bubble-high';
                        bubbleTitle = 'حباب بالا';
                    } else if (item.bubble > 5000000) {
                        bubbleClass = 'bubble-medium';
                        bubbleTitle = 'حباب متوسط';
                    } else {
                        bubbleClass = 'bubble-low';
                        bubbleTitle = 'حباب کم';
                    }
                }
                
                html += `
                    <tr class="hover-lift">
                        <td>${item.name}</td>
                        <td>${formatNumber(item.price || item.sell)} ${item.unit || 'تومان'}</td>
                        <td class="${priceChangeClass}">${item.price_change ? (item.price_change > 0 ? '+' : '') + formatNumber(item.price_change) : '-'}</td>
                        <td>${item.bubble ? `<span class="bubble-indicator ${bubbleClass}" title="${bubbleTitle}"></span>${formatNumber(item.bubble)}` : '-'}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                <p style="font-size: var(--font-size-xs); color: var(--text-tertiary); margin-top: var(--spacing-base); text-align: left;">
                    آخرین بروزرسانی: ${new Date().toLocaleString('fa-IR')}
                </p>
            `;
            
            document.getElementById('goldPricesContainer').innerHTML = html;
        }
        
        // تابع نمایش قیمت‌های ارز در جدول
        function displayCurrencyPrices() {
            if (!currencyData) return;
            
            let html = `
                <h3 style="margin-bottom: var(--spacing-lg); color: var(--color-orange-primary);">قیمت‌های لحظه‌ای ارز</h3>
                <div style="overflow-x: auto; border-radius: var(--border-radius-md);">
                    <table class="price-table">
                        <thead>
                            <tr>
                                <th>نام</th>
                                <th>قیمت</th>
                                <th>تغییر</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            currencyData.forEach(item => {
                // تعیین کلاس برای تغییرات قیمت
                const priceChangeClass = item.price_change > 0 ? 'price-up' : (item.price_change < 0 ? 'price-down' : '');
                
                html += `
                    <tr class="hover-lift">
                        <td>${item.name}</td>
                        <td>${formatNumber(item.price)} ${item.unit || 'تومان'}</td>
                        <td class="${priceChangeClass}">${item.price_change ? (item.price_change > 0 ? '+' : '') + formatNumber(item.price_change) : '-'}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
                <p style="font-size: var(--font-size-xs); color: var(--text-tertiary); margin-top: var(--spacing-base); text-align: left;">
                    آخرین بروزرسانی: ${new Date().toLocaleString('fa-IR')}
                </p>
            `;
            
            document.getElementById('currencyPricesContainer').innerHTML = html;
        }
        
        // تابع بروزرسانی قیمت‌های هدر
        function updateHeaderPrices() {
            if (!goldData || !currencyData) return;
            
            // یافتن داده‌های مورد نیاز
            const goldOunce = goldData.find(item => item.name === "انس جهانی طلا" || item.name.includes("انس"));
            const gold18 = goldData.find(item => item.name === "یک گرم طلای 18 عیار" || item.name.includes("18 عیار"));
            const coinEmami = goldData.find(item => item.name === "سکه امامی" || item.name.includes("امامی"));
            const dollar = currencyData.find(item => item.name === "دلار" || item.name.includes("دلار"));
            
            let html = '';
            
            // اضافه کردن کارت انس جهانی
            if (goldOunce) {
                const priceChangeClass = goldOunce.price_change > 0 ? 'price-up' : (goldOunce.price_change < 0 ? 'price-down' : '');
                html += `
                    <div class="price-card">
                        <div class="price-title">
                            <div class="price-icon">$</div>
                            انس جهانی طلا
                        </div>
                        <div class="price-value">${formatNumber(goldOunce.price || goldOunce.sell)} ${goldOunce.unit || 'دلار'}</div>
                        <div class="price-change ${priceChangeClass}">${goldOunce.price_change ? (goldOunce.price_change > 0 ? '▲ ' : '▼ ') + formatNumber(Math.abs(goldOunce.price_change)) : '-'}</div>
                        <div class="price-meta">
                            <div class="price-meta-item">
                                <span>بروزرسانی:</span>
                                <span>${new Date().toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'})}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // اضافه کردن کارت طلای 18 عیار
            if (gold18) {
                const priceChangeClass = gold18.price_change > 0 ? 'price-up' : (gold18.price_change < 0 ? 'price-down' : '');
                html += `
                    <div class="price-card">
                        <div class="price-title">
                            <div class="price-icon">₮</div>
                            طلای ۱۸ عیار
                        </div>
                        <div class="price-value">${formatNumber(gold18.price || gold18.sell)} تومان</div>
                        <div class="price-change ${priceChangeClass}">${gold18.price_change ? (gold18.price_change > 0 ? '▲ ' : '▼ ') + formatNumber(Math.abs(gold18.price_change)) : '-'}</div>
                        <div class="price-meta">
                            <div class="price-meta-item">
                                <span>بروزرسانی:</span>
                                <span>${new Date().toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'})}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // اضافه کردن کارت سکه امامی
            if (coinEmami) {
                const priceChangeClass = coinEmami.price_change > 0 ? 'price-up' : (coinEmami.price_change < 0 ? 'price-down' : '');
                html += `
                    <div class="price-card">
                        <div class="price-title">
                            <div class="price-icon">⚪</div>
                            سکه امامی
                        </div>
                        <div class="price-value">${formatNumber(coinEmami.price || coinEmami.sell)} تومان</div>
                        <div class="price-change ${priceChangeClass}">${coinEmami.price_change ? (coinEmami.price_change > 0 ? '▲ ' : '▼ ') + formatNumber(Math.abs(coinEmami.price_change)) : '-'}</div>
                        <div class="price-meta">
                            <div class="price-meta-item">
                                <span>بروزرسانی:</span>
                                <span>${new Date().toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'})}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // اضافه کردن کارت دلار
            if (dollar) {
                const priceChangeClass = dollar.price_change > 0 ? 'price-up' : (dollar.price_change < 0 ? 'price-down' : '');
                html += `
                    <div class="price-card">
                        <div class="price-title">
                            <div class="price-icon">$</div>
                            دلار آمریکا
                        </div>
                        <div class="price-value">${formatNumber(dollar.price)} تومان</div>
                        <div class="price-change ${priceChangeClass}">${dollar.price_change ? (dollar.price_change > 0 ? '▲ ' : '▼ ') + formatNumber(Math.abs(dollar.price_change)) : '-'}</div>
                        <div class="price-meta">
                            <div class="price-meta-item">
                                <span>بروزرسانی:</span>
                                <span>${new Date().toLocaleTimeString('fa-IR', {hour: '2-digit', minute: '2-digit'})}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('headerPriceInfo').innerHTML = html;
        }
        
        // تابع فرمت کردن اعداد
        function formatNumber(num) {
            if (num === undefined || num === null) return '-';
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        
        // تابع راه‌اندازی تب‌ها
        function setupTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // غیرفعال کردن همه تب‌ها
                    tabs.forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    
                    // فعال کردن تب انتخاب شده
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }
        
        // تابع راه‌اندازی دکمه‌های تایم‌فریم
        function setupTimeframeButtons() {
            const timeframeButtons = document.querySelectorAll('.timeframe-btn');
            timeframeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    timeframeButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // تغییر تایم‌فریم نمودار
                    currentTimeframe = this.getAttribute('data-timeframe');
                    changeChartTimeframe(currentTimeframe);
                });
            });
        }
        
        // تابع تغییر تایم‌فریم نمودار
        function changeChartTimeframe(timeframe) {
            if (!tvWidget) return;
            
            // تبدیل تایم‌فریم به فرمت TradingView
            let interval;
            switch(timeframe) {
                case 'M5': interval = '5'; break;
                case 'M15': interval = '15'; break;
                case 'M30': interval = '30'; break;
                case 'H1': interval = '60'; break;
                case 'H4': interval = '240'; break;
                case 'D1': interval = 'D'; break;
                default: interval = '5';
            }
            
            // تغییر تایم‌فریم
            tvWidget.setSymbol('OANDA:XAUUSD', interval);
            
            // نمایش اعلان
            showNotification(`تایم‌فریم به ${this.textContent} تغییر کرد`, 'info');
        }
        
        // تابع بروزرسانی نمودار
        function refreshChart() {
            if (tvWidget) {
                tvWidget.reload();
                showNotification('نمودار با موفقیت بروزرسانی شد', 'success');
            }
        }
        
        // تابع اعمال تنظیمات ایچیموکو
        function applyIchimokuSettings() {
            // خواندن مقادیر از ورودی‌ها
            ichimokuSettings.tenkanSen = parseInt(document.getElementById('tenkanSen').value) || 9;
            ichimokuSettings.kijunSen = parseInt(document.getElementById('kijunSen').value) || 26;
            ichimokuSettings.senkouSpanB = parseInt(document.getElementById('senkouSpanB').value) || 52;
            ichimokuSettings.chikouSpan = parseInt(document.getElementById('chikouSpan').value) || 26;
            
            // بازسازی نمودار با تنظیمات جدید
            if (tvWidget) {
                // حذف ویجت فعلی
                document.getElementById('chartContainer').innerHTML = '';
                
                // ایجاد ویجت جدید با تنظیمات به‌روز شده
                initTradingViewChart();
                
                // بروزرسانی تحلیل‌ها و سیگنال‌ها
                generateTradingSignals();
                generateTechnicalAnalysis();
                generatePricePrediction();
                
                // نمایش اعلان
                showNotification('تنظیمات ایچیموکو با موفقیت اعمال شد', 'success');
            }
        }
        
        // تابع تولید سیگنال‌های معاملاتی
        function generateTradingSignals() {
            document.getElementById('signalsList').innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>در حال تحلیل سیگنال‌ها...</p>
                </div>
            `;
            
            // شبیه‌سازی تأخیر در تحلیل
            setTimeout(() => {
                // اینجا در واقعیت باید از داده‌های واقعی نمودار استفاده شود
                // اما برای نمونه، سیگنال‌های نمایشی تولید می‌کنیم
                
                let html = '';
                
                // سیگنال خرید بر اساس تقاطع تنکان-سن و کیجون-سن
                html += `
                    <li class="signal-item">
                        <div class="signal-time">امروز ${new Date().toLocaleTimeString('fa-IR', {hour: '2-digit', minute:'2-digit'})}</div>
                        <div class="signal-type signal-buy">سیگنال خرید</div>
                        <div class="signal-desc">تنکان-سن از پایین کیجون-سن را قطع کرده و قیمت بالای ابر کومو قرار دارد. هدف قیمتی: ${formatNumber(Math.round(1940 + Math.random() * 20))} دلار</div>
                    </li>
                `;
                
                // سیگنال فروش بر اساس چیکو اسپن
                html += `
                    <li class="signal-item">
                        <div class="signal-time">دیروز 14:30</div>
                        <div class="signal-type signal-sell">سیگنال فروش</div>
                        <div class="signal-desc">چیکو اسپن زیر قیمت 26 دوره قبل قرار گرفته و تنکان-سن و کیجون-سن تقاطع نزولی ایجاد کرده‌اند. حد ضرر: ${formatNumber(Math.round(1930 + Math.random() * 10))} دلار</div>
                    </li>
                `;
                
                // سیگنال خرید بر اساس ابر کومو
                html += `
                    <li class="signal-item">
                        <div class="signal-time">3 روز پیش 09:15</div>
                        <div class="signal-type signal-buy">سیگنال خرید</div>
                        <div class="signal-desc">قیمت از ابر کومو عبور کرده و ابر از قرمز به سبز تغییر رنگ داده است. این نشانه قدرت روند صعودی است.</div>
                    </li>
                `;
                
                document.getElementById('signalsList').innerHTML = html;
            }, 1500);
        }
        
        // تابع تولید تحلیل تکنیکال
        function generateTechnicalAnalysis() {
            document.getElementById('technicalAnalysisContainer').innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>در حال تحلیل تکنیکال...</p>
                </div>
            `;
            
            // شبیه‌سازی تأخیر در تحلیل
            setTimeout(() => {
                let html = `
                    <h3 style="margin-bottom: var(--spacing-lg); color: var(--color-orange-primary);">تحلیل تکنیکال فعلی</h3>
                    <p>در حال حاضر، قیمت طلا در یک روند صعودی قرار دارد. خطوط تنکان-سن و کیجون-سن تقاطع صعودی ایجاد کرده‌اند که نشانه‌ای قوی برای ادامه روند صعودی است.</p>
                    <p style="margin-top: var(--spacing-md);">ابر کومو نیز در حال تغییر رنگ به سبز است که تأییدی بر قدرت روند صعودی می‌باشد. چیکو اسپن بالای قیمت قرار گرفته و مقاومت قابل توجهی در محدوده <span class="highlight-text">${formatNumber(Math.round(1950 + Math.random() * 10))}</span> دلار وجود دارد.</p>
                    
                    <div style="margin-top: var(--spacing-lg); padding: var(--spacing-lg); background-color: var(--bg-tertiary); border-radius: var(--border-radius-md);">
                        <p><strong class="highlight-text">وضعیت شاخص‌های ایچیموکو:</strong></p>
                        <ul style="margin-top: var(--spacing-md); padding-right: var(--spacing-lg);">
                            <li><strong>تنکان-سن:</strong> <span class="highlight-text">${formatNumber(Math.round(1925 + Math.random() * 5))}</span> دلار</li>
                            <li><strong>کیجون-سن:</strong> <span class="highlight-text">${formatNumber(Math.round(1915 + Math.random() * 5))}</span> دلار</li>
                            <li><strong>سنکو اسپن A:</strong> <span class="highlight-text">${formatNumber(Math.round(1910 + Math.random() * 5))}</span> دلار</li>
                            <li><strong>سنکو اسپن B:</strong> <span class="highlight-text">${formatNumber(Math.round(1900 + Math.random() * 5))}</span> دلار</li>
                        </ul>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg); margin-top: var(--spacing-lg);">
                        <div style="padding: var(--spacing-lg); background-color: var(--bg-tertiary); border-radius: var(--border-radius-md);">
                            <p><strong class="highlight-text">سطوح حمایتی مهم:</strong></p>
                            <ul style="margin-top: var(--spacing-md); padding-right: var(--spacing-lg);">
                                <li>${formatNumber(Math.round(1920 + Math.random() * 3))} دلار (کیجون-سن)</li>
                                <li>${formatNumber(Math.round(1905 + Math.random() * 3))} دلار (لبه بالایی ابر کومو)</li>
                                <li>${formatNumber(Math.round(1890 + Math.random() * 3))} دلار (لبه پایینی ابر کومو)</li>
                            </ul>
                        </div>
                        
                        <div style="padding: var(--spacing-lg); background-color: var(--bg-tertiary); border-radius: var(--border-radius-md);">
                            <p><strong class="highlight-text">سطوح مقاومتی مهم:</strong></p>
                            <ul style="margin-top: var(--spacing-md); padding-right: var(--spacing-lg);">
                                <li>${formatNumber(Math.round(1940 + Math.random() * 3))} دلار (مقاومت اخیر)</li>
                                <li>${formatNumber(Math.round(1950 + Math.random() * 3))} دلار (سطح فیبوناچی 61.8%)</li>
                                <li>${formatNumber(Math.round(1970 + Math.random() * 3))} دلار (مقاومت روانی)</li>
                            </ul>
                        </div>
                    </div>
                `;
                
                document.getElementById('technicalAnalysisContainer').innerHTML = html;
            }, 2000);
        }
        
        // تابع تولید پیش‌بینی قیمت
        function generatePricePrediction() {
            document.getElementById('pricePredictionContainer').innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>در حال محاسبه پیش‌بینی‌ها...</p>
                </div>
            `;
            
            // شبیه‌سازی تأخیر در تحلیل
            setTimeout(() => {
                let html = `
                    <h3 style="margin-bottom: var(--spacing-lg); color: var(--color-orange-primary);">پیش‌بینی قیمت طلا</h3>
                    <p>براساس الگوریتم ایچیموکو و تحلیل‌های تکنیکال، پیش‌بینی می‌شود قیمت طلا در کوتاه‌مدت (1-2 هفته آینده) به محدوده <span class="highlight-text">${formatNumber(Math.round(1940 + Math.random() * 10))}-${formatNumber(Math.round(1950 + Math.random() * 10))}</span> دلار برسد.</p>
                    <p style="margin-top: var(--spacing-md);">در میان‌مدت (1-3 ماه آینده)، انتظار می‌رود قیمت طلا با توجه به قدرت ابر کومو به محدوده <span class="highlight-text">${formatNumber(Math.round(1980 + Math.random() * 10))}-${formatNumber(Math.round(2000 + Math.random() * 20))}</span> دلار صعود کند.</p>
                    
                    <div style="margin-top: var(--spacing-lg); padding: var(--spacing-lg); background-color: var(--bg-tertiary); border-radius: var(--border-radius-md);">
                        <p><strong class="highlight-text">عوامل تأثیرگذار بر این پیش‌بینی:</strong></p>
                        <ul style="margin-top: var(--spacing-md); padding-right: var(--spacing-lg);">
                            <li><strong>سیاست‌های پولی فدرال رزرو:</strong> احتمال کاهش نرخ بهره در ماه‌های آینده می‌تواند به نفع طلا باشد.</li>
                            <li><strong>تنش‌های ژئوپلیتیکی:</strong> افزایش تنش‌ها در خاورمیانه و اروپای شرقی، تقاضا برای طلا به عنوان دارایی امن را افزایش می‌دهد.</li>
                            <li><strong>قدرت شاخص دلار:</strong> ضعف اخیر دلار آمریکا به تقویت قیمت طلا کمک کرده است.</li>
                            <li><strong>نرخ بازدهی اوراق قرضه:</strong> کاهش بازدهی اوراق قرضه آمریکا، جذابیت طلا را افزایش می‌دهد.</li>
                        </ul>
                    </div>
                    
                    <div style="margin-top: var(--spacing-lg); display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg);">
                        <div style="padding: var(--spacing-lg); background-color: rgba(22, 199, 132, 0.1); border-radius: var(--border-radius-md); border-right: 3px solid var(--color-green);">
                            <p><strong style="color: var(--color-green);">سناریوی صعودی:</strong></p>
                            <p style="margin-top: var(--spacing-sm);">عبور از مقاومت ${formatNumber(Math.round(1950 + Math.random() * 5))} دلار می‌تواند مسیر را برای رسیدن به ${formatNumber(Math.round(2000 + Math.random() * 20))} دلار هموار کند.</p>
                        </div>
                        
                        <div style="padding: var(--spacing-lg); background-color: rgba(234, 57, 67, 0.1); border-radius: var(--border-radius-md); border-right: 3px solid var(--color-red);">
                            <p><strong style="color: var(--color-red);">سناریوی نزولی:</strong></p>
                            <p style="margin-top: var(--spacing-sm);">شکست حمایت ${formatNumber(Math.round(1900 + Math.random() * 5))} دلار می‌تواند باعث سقوط قیمت تا ${formatNumber(Math.round(1850 + Math.random() * 20))} دلار شود.</p>
                        </div>
                    </div>
                `;
                
                document.getElementById('pricePredictionContainer').innerHTML = html;
            }, 2500);
        }
        
        // تابع اضافه کردن خط روند
        function addTrendLine() {
            if (tvWidget) {
                tvWidget.activeChart().createDrawing('LineToolTrendLine');
                showNotification('ابزار خط روند فعال شد. روی نمودار کلیک کنید و خط روند خود را رسم کنید.', 'info');
            }
        }
        
        // تابع اضافه کردن فیبوناچی
        function addFibonacci() {
            if (tvWidget) {
                tvWidget.activeChart().createDrawing('LineToolFibRetracement');
                showNotification('ابزار فیبوناچی فعال شد. روی نمودار کلیک کنید و ابزار فیبوناچی خود را رسم کنید.', 'info');
            }
        }
        
        // تابع ذخیره تحلیل
        function saveAnalysis() {
            if (tvWidget) {
                tvWidget.activeChart().createScreenshot().then(function(url) {
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `تحلیل-طلا-${new Date().toISOString().slice(0, 10)}.png`;
                    link.click();
                    showNotification('تحلیل شما با موفقیت ذخیره شد', 'success');
                });
            } else {
                showNotification('نمودار هنوز بارگذاری نشده است', 'error');
            }
        }
        
        // تابع باز کردن مودال اخبار
        function openNewsModal(title, content, impact) {
            document.getElementById('newsModalTitle').textContent = title;
            document.getElementById('newsModalContent').textContent = content;
            document.getElementById('newsModalImpact').textContent = impact;
            document.getElementById('newsModal').style.display = 'block';
        }
        
        // تابع باز کردن مودال همه اخبار
        function openAllNewsModal() {
            document.getElementById('allNewsModal').style.display = 'block';
        }
        
        // تابع باز کردن مودال آموزش
        function openTutorialModal() {
            document.getElementById('tutorialModal').style.display = 'block';
        }
        
        // تابع بستن مودال‌ها
        function closeModal(modalId) { 
            document.getElementById(modalId).style.display = 'none';
        }
        
        // بستن مودال‌ها با کلیک بیرون از محتوا
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            });
        };
    </script>
</body>
</html>
